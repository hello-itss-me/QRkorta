/*
  # Создание справочника подшипников

  1. Новые таблицы
    - `bearings`
      - `id` (uuid, primary key)
      - `designation` (text) - обозначение подшипника (например: 6309-2RS)
      - `inner_diameter` (decimal) - внутренний диаметр в мм
      - `outer_diameter` (decimal) - наружный диаметр в мм
      - `width` (decimal) - ширина в мм
      - `bearing_type` (text) - тип подшипника (шариковый, роликовый и т.д.)
      - `seal_type` (text) - тип уплотнения (открытый, 2RS, ZZ и т.д.)
      - `manufacturer` (text) - производитель
      - `price_per_unit` (decimal) - цена за штуку
      - `description` (text) - описание
      - `is_active` (boolean) - активен ли подшипник
      - `created_at` (timestamp)
      - `updated_at` (timestamp)

  2. Безопасность
    - Включить RLS для таблицы `bearings`
    - Добавить политики для чтения, вставки и обновления
*/

-- Создаем таблицу подшипников
CREATE TABLE IF NOT EXISTS bearings (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  designation text NOT NULL,
  inner_diameter decimal(8,2) NOT NULL,
  outer_diameter decimal(8,2) NOT NULL,
  width decimal(8,2) NOT NULL,
  bearing_type text DEFAULT 'Шариковый',
  seal_type text DEFAULT 'Открытый',
  manufacturer text DEFAULT '',
  price_per_unit decimal(10,2) NOT NULL DEFAULT 0,
  description text DEFAULT '',
  is_active boolean DEFAULT true,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);

-- Создаем уникальный индекс для обозначения подшипника
CREATE UNIQUE INDEX IF NOT EXISTS bearings_designation_key 
  ON bearings (designation) 
  WHERE is_active = true;

-- Включаем RLS
ALTER TABLE bearings ENABLE ROW LEVEL SECURITY;

-- Политика для чтения данных (доступно всем)
CREATE POLICY "Anyone can read bearings"
  ON bearings
  FOR SELECT
  USING (true);

-- Политика для вставки данных (доступно всем для демо)
CREATE POLICY "Anyone can insert bearings"
  ON bearings
  FOR INSERT
  WITH CHECK (true);

-- Политика для обновления данных (доступно всем для демо)
CREATE POLICY "Anyone can update bearings"
  ON bearings
  FOR UPDATE
  USING (true);

-- Триггер для автоматического обновления updated_at
CREATE TRIGGER update_bearings_updated_at
  BEFORE UPDATE ON bearings
  FOR EACH ROW
  EXECUTE FUNCTION update_updated_at_column();

-- Вставляем начальные данные подшипников
INSERT INTO bearings (designation, inner_diameter, outer_diameter, width, bearing_type, seal_type, manufacturer, price_per_unit, description) VALUES
  -- Серия 6200
  ('6201-2RS', 12, 32, 10, 'Шариковый', '2RS', 'SKF', 280.00, 'Радиальный шариковый подшипник с резиновыми уплотнениями'),
  ('6202-2RS', 15, 35, 11, 'Шариковый', '2RS', 'SKF', 320.00, 'Радиальный шариковый подшипник с резиновыми уплотнениями'),
  ('6203-2RS', 17, 40, 12, 'Шариковый', '2RS', 'SKF', 380.00, 'Радиальный шариковый подшипник с резиновыми уплотнениями'),
  ('6204-2RS', 20, 47, 14, 'Шариковый', '2RS', 'SKF', 450.00, 'Радиальный шариковый подшипник с резиновыми уплотнениями'),
  ('6205-2RS', 25, 52, 15, 'Шариковый', '2RS', 'SKF', 520.00, 'Радиальный шариковый подшипник с резиновыми уплотнениями'),
  ('6206-2RS', 30, 62, 16, 'Шариковый', '2RS', 'SKF', 680.00, 'Радиальный шариковый подшипник с резиновыми уплотнениями'),
  ('6207-2RS', 35, 72, 17, 'Шариковый', '2RS', 'SKF', 850.00, 'Радиальный шариковый подшипник с резиновыми уплотнениями'),
  ('6208-2RS', 40, 80, 18, 'Шариковый', '2RS', 'SKF', 980.00, 'Радиальный шариковый подшипник с резиновыми уплотнениями'),
  ('6209-2RS', 45, 85, 19, 'Шариковый', '2RS', 'SKF', 1150.00, 'Радиальный шариковый подшипник с резиновыми уплотнениями'),
  ('6210-2RS', 50, 90, 20, 'Шариковый', '2RS', 'SKF', 1280.00, 'Радиальный шариковый подшипник с резиновыми уплотнениями'),
  
  -- Серия 6300
  ('6301-2RS', 12, 37, 12, 'Шариковый', '2RS', 'SKF', 350.00, 'Радиальный шариковый подшипник с резиновыми уплотнениями'),
  ('6302-2RS', 15, 42, 13, 'Шариковый', '2RS', 'SKF', 420.00, 'Радиальный шариковый подшипник с резиновыми уплотнениями'),
  ('6303-2RS', 17, 47, 14, 'Шариковый', '2RS', 'SKF', 480.00, 'Радиальный шариковый подшипник с резиновыми уплотнениями'),
  ('6304-2RS', 20, 52, 15, 'Шариковый', '2RS', 'SKF', 580.00, 'Радиальный шариковый подшипник с резиновыми уплотнениями'),
  ('6305-2RS', 25, 62, 17, 'Шариковый', '2RS', 'SKF', 720.00, 'Радиальный шариковый подшипник с резиновыми уплотнениями'),
  ('6306-2RS', 30, 72, 19, 'Шариковый', '2RS', 'SKF', 890.00, 'Радиальный шариковый подшипник с резиновыми уплотнениями'),
  ('6307-2RS', 35, 80, 21, 'Шариковый', '2RS', 'SKF', 1050.00, 'Радиальный шариковый подшипник с резиновыми уплотнениями'),
  ('6308-2RS', 40, 90, 23, 'Шариковый', '2RS', 'SKF', 1280.00, 'Радиальный шариковый подшипник с резиновыми уплотнениями'),
  ('6309-2RS', 45, 100, 25, 'Шариковый', '2RS', 'SKF', 1520.00, 'Радиальный шариковый подшипник с резиновыми уплотнениями'),
  ('6310-2RS', 50, 110, 27, 'Шариковый', '2RS', 'SKF', 1850.00, 'Радиальный шариковый подшипник с резиновыми уплотнениями'),
  
  -- Открытые подшипники
  ('6205', 25, 52, 15, 'Шариковый', 'Открытый', 'SKF', 380.00, 'Радиальный шариковый подшипник открытого типа'),
  ('6206', 30, 62, 16, 'Шариковый', 'Открытый', 'SKF', 520.00, 'Радиальный шариковый подшипник открытого типа'),
  ('6207', 35, 72, 17, 'Шариковый', 'Открытый', 'SKF', 680.00, 'Радиальный шариковый подшипник открытого типа'),
  ('6208', 40, 80, 18, 'Шариковый', 'Открытый', 'SKF', 750.00, 'Радиальный шариковый подшипник открытого типа'),
  ('6209', 45, 85, 19, 'Шариковый', 'Открытый', 'SKF', 890.00, 'Радиальный шариковый подшипник открытого типа'),
  
  -- Роликовые подшипники
  ('NU205', 25, 52, 15, 'Роликовый', 'Открытый', 'SKF', 850.00, 'Цилиндрический роликовый подшипник'),
  ('NU206', 30, 62, 16, 'Роликовый', 'Открытый', 'SKF', 1050.00, 'Цилиндрический роликовый подшипник'),
  ('NU207', 35, 72, 17, 'Роликовый', 'Открытый', 'SKF', 1280.00, 'Цилиндрический роликовый подшипник'),
  ('NU208', 40, 80, 18, 'Роликовый', 'Открытый', 'SKF', 1520.00, 'Цилиндрический роликовый подшипник'),
  ('NU209', 45, 85, 19, 'Роликовый', 'Открытый', 'SKF', 1780.00, 'Цилиндрический роликовый подшипник')
ON CONFLICT DO NOTHING;
